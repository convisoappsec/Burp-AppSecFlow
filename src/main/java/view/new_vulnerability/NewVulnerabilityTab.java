package view.new_vulnerability;

import burp.IBurpExtenderCallbacks;
import burp.IExtensionHelpers;
import com.jgoodies.forms.layout.CellConstraints;
import com.jgoodies.forms.layout.FormLayout;
import models.AutoFilterComboboxModel;
import models.vulnerability.Evidence;
import models.vulnerability.Template;
import models.vulnerability.Vulnerability;
import org.commonmark.node.Node;
import org.commonmark.parser.Parser;
import org.commonmark.renderer.html.HtmlRenderer;
import services.TemplateService;
import services.VulnerabilityService;
import utilities.Util;
import view.new_vulnerability.custom.popup_menu.EvidencePopupMenu;
import view.new_vulnerability.listeners.AutoFilterComboboxListener;
import view.new_vulnerability.listeners.RefreshTemplatesButtonListener;

import javax.swing.*;
import javax.swing.border.TitledBorder;
import javax.swing.event.ChangeListener;
import javax.swing.plaf.FontUIResource;
import javax.swing.text.StyleContext;
import java.awt.*;
import java.awt.event.*;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Locale;
import java.util.Objects;

public class NewVulnerabilityTab {
    private JComboBox cbVulnerabilityTemplates;
    private JRadioButton probabilityLowRButton;
    private JRadioButton probabilityMediumRButton;
    private JRadioButton probabilityHighRButton;
    private JRadioButton impactLowRButton;
    private JRadioButton impactMediumRButton;
    private JRadioButton impactHighRButton;
    private JEditorPane txtAreaDescription;
    private JButton btnRefreshVT;
    private JTextField txtFieldMethod;
    private JTextField txtFieldProtocol;
    private JTextField txtFieldUrl;
    private JTextArea txtAreaRequest;
    private JTextArea txtAreaResponse;
    private JList listParameters;
    private JButton btnRemoveParameter;
    private JButton btnRemoveAllParameters;
    private JButton btnRedactValue;
    private JScrollPane rootPanel;
    private JPanel rootPanel2;
    private IBurpExtenderCallbacks callbacks;
    private IExtensionHelpers helpers;
    private Util util;
    private TemplateService templateService;
    private VulnerabilityService vulnerabilityService;
    DefaultListModel<String> parametersListModel;
    DefaultListModel<Evidence> evidenceListModel;
    private JEditorPane txtAreaStepsToReproduce;
    private JButton btnSubmitForm;
    private JButton btnClearForm;
    private JTextArea txtAreaImpact;
    private JRadioButton noCompromisedEnvironmentRButton;
    private JRadioButton yesCompromisedEnvironmentRButton;
    private JTabbedPane tabParametersRequestResponse;
    private JTabbedPane tabDescriptionImpactSteps;
    private JTextArea txtAreaCompromisedEnvironment;
    private JScrollPane scrollPaneCompromisedEnvironment;
    private JLabel lblImpact;
    private JLabel lblProbability;
    private JLabel lblMethod;
    private JLabel lblProtocol;
    private JLabel lblUrl;
    private JLabel lblVulnerabilityTemplate;
    private JLabel lblCompromisedEnvironment;
    private JList listEvidence;
    private JButton btnPreviewDescription;
    private JButton btnPreviewStepsToReproduce;
    private Color defaultLblColor;
    private String evidencePlaceholder = "<html><b>Double left click</b> or <b>Right click</b> to add new evidence</html>";
    private AutoFilterComboboxModel autoFilterComboboxModel;
    private boolean fromContextMenu;
    boolean previewMarkdownDescription, previewMarkdownStepsToReproduce;
    HashMap<String, String> beforePreviewContents;
    Parser parser = Parser.builder().build();
    HtmlRenderer renderer = HtmlRenderer.builder().build();


    public NewVulnerabilityTab(final IBurpExtenderCallbacks callbacks, final IExtensionHelpers helpers, final TemplateService templateService) {
        this.callbacks = callbacks;
        this.helpers = helpers;
        this.templateService = new TemplateService(this.callbacks, this.helpers);
        this.vulnerabilityService = new VulnerabilityService(this.callbacks, this.helpers, this);
        this.util = new Util(callbacks, helpers);
        this.parametersListModel = new DefaultListModel<String>();
        this.evidenceListModel = new DefaultListModel<Evidence>();
        this.fromContextMenu = false;
        this.previewMarkdownDescription = false;
        this.previewMarkdownStepsToReproduce = false;
        this.beforePreviewContents = new HashMap<>();
    }

    public void initializeComponent() {

        // GUI initializer generated by IntelliJ IDEA GUI Designer
        // >>> IMPORTANT!! <<<
        // DO NOT EDIT OR ADD ANY CODE HERE!
        $$$setupUI$$$();

        this.defaultLblColor = lblVulnerabilityTemplate.getForeground();

        autoFilterComboboxModel = new AutoFilterComboboxModel();
        cbVulnerabilityTemplates.setModel(autoFilterComboboxModel);
        cbVulnerabilityTemplates.putClientProperty("JComboBox.isTableCellEditor", Boolean.TRUE);

        final RefreshTemplatesButtonListener rtb = new RefreshTemplatesButtonListener(this.callbacks, this.helpers, cbVulnerabilityTemplates, this.templateService);
        btnRefreshVT.addActionListener(e -> new Thread(() -> rtb.mouseClicked(e)).start());


        cbVulnerabilityTemplates.addActionListener(e -> {
            switch (e.getActionCommand()) {
                case "comboBoxChanged": // monitorar para verificar o template escolhido
                    try {
                        String selectedTemplateTitle = cbVulnerabilityTemplates.getSelectedItem().toString();
                        if (!selectedTemplateTitle.isEmpty()) {
                            Template templatePicked = templateService.getTemplateByTitle(cbVulnerabilityTemplates.getSelectedItem().toString());
                            if (templatePicked != null && !templatePicked.getNotification()) {
                                this.notificationTemplateSelected(false);
                                switch (templatePicked.getProbability()) {
                                    case "high":
                                        probabilityHighRButton.setSelected(true);
                                        break;
                                    case "medium":
                                        probabilityMediumRButton.setSelected(true);
                                        break;
                                    case "low":
                                        probabilityLowRButton.setSelected(true);
                                        break;
                                }
                                switch (templatePicked.getImpact()) {
                                    case "high":
                                        impactHighRButton.setSelected(true);
                                        break;
                                    case "medium":
                                        impactMediumRButton.setSelected(true);
                                        break;
                                    case "low":
                                        impactLowRButton.setSelected(true);
                                        break;
                                }
                                cbVulnerabilityTemplates.requestFocus();
                            } else if (templatePicked != null && templatePicked.getNotification()) {
                                this.notificationTemplateSelected(true);
                            }
                        }
                    } catch (NullPointerException ignored) {
                    }
                    break;
                case "comboBoxEdited":
                    break;

            }
        });

        MouseAdapter rdButtonlistener = new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                requestFocusNextFieldRadioButtons();
            }
        };
        probabilityLowRButton.addMouseListener(rdButtonlistener);
        probabilityMediumRButton.addMouseListener(rdButtonlistener);
        probabilityHighRButton.addMouseListener(rdButtonlistener);
        impactLowRButton.addMouseListener(rdButtonlistener);
        impactMediumRButton.addMouseListener(rdButtonlistener);
        impactHighRButton.addMouseListener(rdButtonlistener);

        btnRemoveParameter.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                new Thread(() -> parametersListModel.remove(listParameters.getSelectedIndex())).start();
            }
        });

        btnRemoveAllParameters.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                new Thread(() -> parametersListModel.clear()).start();
            }
        });

        btnRedactValue.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                new Thread(() -> {
                    String value = parametersListModel.get(listParameters.getSelectedIndex());
                    parametersListModel.set(listParameters.getSelectedIndex(), value.substring(0, value.indexOf("=")) + "=**REDACTED**");
                }).start();
            }
        });

        btnSubmitForm.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {

                try {
                    Template templatePicked = templateService.getTemplateByTitle(Objects.requireNonNull(cbVulnerabilityTemplates.getSelectedItem()).toString());
                    Vulnerability vulnerability;
                    if (templatePicked.getNotification()) {
                        vulnerability = validateNotification();
                    } else {
                        vulnerability = validateVulnerability();
                    }

                    if (vulnerability != null) {
                        vulnerabilityService.submitVulnerabilityForm(vulnerability);

                    }
                } catch (NullPointerException ignored) {

                }
            }
        });

        yesCompromisedEnvironmentRButton.addMouseListener(new MouseAdapter() {
            @Override
            public void mousePressed(MouseEvent e) {
                new Thread(() -> {
                    noCompromisedEnvironmentRButton.setEnabled(false);
                    scrollPaneCompromisedEnvironment.setVisible(true);
                    txtAreaCompromisedEnvironment.setVisible(true);
                    txtAreaCompromisedEnvironment.requestFocus();
                    noCompromisedEnvironmentRButton.setEnabled(true);
                }).start();

            }
        });

        noCompromisedEnvironmentRButton.addMouseListener(new MouseAdapter() {
            @Override
            public void mousePressed(MouseEvent e) {
                new Thread(() -> {
                    yesCompromisedEnvironmentRButton.setEnabled(false);
                    scrollPaneCompromisedEnvironment.setVisible(false);
                    txtAreaCompromisedEnvironment.setVisible(false);
                    requestFocusNextFieldRadioButtons();
                    yesCompromisedEnvironmentRButton.setEnabled(true);
                }).start();

            }
        });

        btnClearForm.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                clearForm();
            }
        });


        ChangeListener tabbChangeListener = e -> {
            if (e.getSource() instanceof JTabbedPane) {
                JTabbedPane tabbedPane = (JTabbedPane) e.getSource();
                setBoldTitleTab(tabbedPane);
            }
        };

        tabParametersRequestResponse.addChangeListener(tabbChangeListener);
        tabDescriptionImpactSteps.addChangeListener(tabbChangeListener);

        this.setBoldTitleTab(tabDescriptionImpactSteps);
        this.setBoldTitleTab(tabParametersRequestResponse);

        this.listEvidence.setModel(this.evidenceListModel);

        listEvidence.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                if (SwingUtilities.isRightMouseButton(e) || (SwingUtilities.isLeftMouseButton(e) && e.getClickCount() == 2)) {
                    EvidencePopupMenu evidencePopupMenu = new EvidencePopupMenu(evidenceListModel, listEvidence);
                    evidencePopupMenu.show((Component) e.getSource(), e.getX(), e.getY());
                }
            }
        });

        evidenceListModel.addElement(new Evidence(evidencePlaceholder, evidencePlaceholder));


        AutoFilterComboboxListener autoFilterComboboxListener = new AutoFilterComboboxListener(this.callbacks, this.helpers, cbVulnerabilityTemplates, templateService);

        JTextField textEditor = (JTextField) cbVulnerabilityTemplates.getEditor().getEditorComponent();
        textEditor.addKeyListener(autoFilterComboboxListener);


        btnPreviewStepsToReproduce.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                previewMarkdownStepsToReproduce = !previewMarkdownStepsToReproduce;
                previewMarkDownText(previewMarkdownStepsToReproduce, "Steps to Reproduce", txtAreaStepsToReproduce);
            }
        });

        btnPreviewDescription.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                previewMarkdownDescription = !previewMarkdownDescription;
                previewMarkDownText(previewMarkdownDescription, "Description", txtAreaDescription);
            }
        });


    }

    private void previewMarkDownText(boolean markDownBooleanVariable, String markDownHashmapKey, JEditorPane txtArea) {
        if (markDownBooleanVariable) {
            String text = txtArea.getText();
            beforePreviewContents.put(markDownHashmapKey, text);
            Node document = parser.parse(text);
            txtArea.setContentType("text/html");
            txtArea.setText(renderer.render(document));
            txtArea.setEnabled(false);
        } else {
            txtArea.setContentType("text/plain");
            txtArea.setText(beforePreviewContents.get(markDownHashmapKey));
            txtArea.setEnabled(true);

        }
    }

    public void requestFocusNextFieldRadioButtons() {

        int selectedTab = tabDescriptionImpactSteps.getSelectedIndex();

        switch (selectedTab) {
            case 0:
                txtAreaDescription.requestFocus();
                break;
            case 1:
                txtAreaImpact.requestFocus();
                break;
            case 2:
                txtAreaStepsToReproduce.requestFocus();
                break;
            default:
                txtFieldMethod.requestFocus();
        }
    }

    public void clearForm() {
        this.fromContextMenu = false;

        txtAreaDescription.setText("");
        txtAreaImpact.setText("");
        txtAreaStepsToReproduce.setText("");

        txtAreaCompromisedEnvironment.setText("");
        noCompromisedEnvironmentRButton.setSelected(true);

        txtFieldMethod.setText("");
        if (!txtFieldMethod.isEnabled()) {
            txtFieldMethod.setEnabled(true);
        }

        txtFieldProtocol.setText("");
        if (!txtFieldProtocol.isEnabled()) {
            txtFieldProtocol.setEnabled(true);
        }

        txtFieldUrl.setText("");
        if (!txtFieldUrl.isEnabled()) {
            txtFieldUrl.setEnabled(true);
        }

        parametersListModel.clear();

        txtAreaRequest.setText("");
        if (!txtAreaRequest.isEnabled()) {
            txtAreaRequest.setEnabled(true);
        }

        txtAreaResponse.setText("");
        if (!txtAreaResponse.isEnabled()) {
            txtAreaResponse.setEnabled(true);
        }

        evidenceListModel.clear();
        listEvidence.putClientProperty("html.disable", Boolean.FALSE);
        evidenceListModel.addElement(new Evidence(evidencePlaceholder, evidencePlaceholder));

        this.notificationTemplateSelected(false);

        AutoFilterComboboxModel autoFilterComboboxModel = (AutoFilterComboboxModel) this.cbVulnerabilityTemplates.getModel();
        if (autoFilterComboboxModel.getSize() > 0) {
            autoFilterComboboxModel.filterList("", false);
            this.cbVulnerabilityTemplates.setSelectedIndex(0);
        }

    }

    private void setBoldTitleTab(JTabbedPane tabbedPane) {
        for (int i = 0; i < tabbedPane.getTabCount(); i++) {
            String tabTitle = tabbedPane.getTitleAt(i);
            if (!tabTitle.contains("style=\"color:red\"")) {
                if (i == tabbedPane.getSelectedIndex()) {
                    tabbedPane.setTitleAt(i, "<html><b>" + tabbedPane.getTitleAt(i) + "</b></html>");
                } else {
                    tabbedPane.setTitleAt(i, tabbedPane.getTitleAt(i).replaceAll("(<.+?>)+", ""));
                }
            } else {
                if (i == tabbedPane.getSelectedIndex()) {
                    tabbedPane.setTitleAt(i, "<html><b><p style=\"color:red\">" + tabbedPane.getTitleAt(i).replaceAll("(<.+?>)+", "").replace("*", "") + "*</p></b></html>");
                } else {
                    tabbedPane.setTitleAt(i, "<html><p style=\"color:red\">" + tabbedPane.getTitleAt(i).replaceAll("(<.+?>)+", "").replace("*", "") + "*</p></html>");
                }
            }
        }
    }

    private void setRequiredTitleTab(JTabbedPane tabbedPane, String tabTitle) {
        for (int i = 0; i < tabbedPane.getTabCount(); i++) {
            if (tabbedPane.getTitleAt(i).contains(tabTitle)) {
                if (i == tabbedPane.getSelectedIndex()) {
                    tabbedPane.setTitleAt(i, "<html><b><p style=\"color:red\">" + tabbedPane.getTitleAt(i).replaceAll("(<.+?>)+", "").replace("*", "") + "*</p></b></html>");
                } else {
                    tabbedPane.setTitleAt(i, "<html><p style=\"color:red\">" + tabbedPane.getTitleAt(i).replaceAll("(<.+?>)+", "").replace("*", "") + "*</p></html>");
                }
            }
        }
    }

    private void removeRequiredTitleTab(JTabbedPane tabbedPane, String tabTitle) {
        for (int i = 0; i < tabbedPane.getTabCount(); i++) {
            if (tabbedPane.getTitleAt(i).contains(tabTitle)) {
                if (i == tabbedPane.getSelectedIndex()) {
                    tabbedPane.setTitleAt(i, "<html><b>" + tabbedPane.getTitleAt(i).replaceAll("(<.+?>)+", "").replace("*", "") + "</b></html>");
                } else {
                    tabbedPane.setTitleAt(i, "<html>" + tabbedPane.getTitleAt(i).replaceAll("(<.+?>)+", "").replace("*", "") + "</html>");
                }
            }
        }
    }

    private void setLblRequired(JLabel label, String text) {
        label.setText(text + "*");
        label.setForeground(Color.RED);
    }

    private void setLblDefault(JLabel label) {
        label.setText(label.getText().replace("*", ""));
        label.setForeground(defaultLblColor);

    }

    private int getDefinedTemplateId() {
        int templateId = 0;
        try {
            templateId = templateService.getTemplateIdByTitle(cbVulnerabilityTemplates.getSelectedItem().toString());
        } catch (NullPointerException ignored) {
        }

        if (templateId == 0) {
            this.setLblRequired(lblVulnerabilityTemplate, "Vulnerability Template");
            return 0;
        } else {
            this.setLblDefault(lblVulnerabilityTemplate);
            return templateId;
        }
    }

    private String getDefinedImpact() {
        if (this.impactHighRButton.isSelected()) {
            this.setLblDefault(lblImpact);
            return this.impactHighRButton.getText().toLowerCase();
        } else if (this.impactMediumRButton.isSelected()) {
            this.setLblDefault(lblImpact);
            return this.impactMediumRButton.getText().toLowerCase();
        } else if (this.impactLowRButton.isSelected()) {
            this.setLblDefault(lblImpact);
            return this.impactLowRButton.getText().toLowerCase();
        } else {
            this.setLblRequired(lblImpact, "Impact");
            return null;
        }
    }

    private String getDefinedProbability() {
        if (this.probabilityHighRButton.isSelected()) {
            this.setLblDefault(lblProbability);
            return this.probabilityHighRButton.getText().toLowerCase();
        } else if (this.probabilityMediumRButton.isSelected()) {
            this.setLblDefault(lblProbability);
            return this.probabilityMediumRButton.getText().toLowerCase();
        } else if (this.probabilityLowRButton.isSelected()) {
            this.setLblDefault(lblProbability);
            return this.probabilityLowRButton.getText().toLowerCase();
        } else {
            this.setLblRequired(lblProbability, "Probability");
            return null;
        }
    }

    private Boolean getCompromisedEnvironment() {
        if (this.yesCompromisedEnvironmentRButton.isSelected()) {
            return true;
        } else if (this.noCompromisedEnvironmentRButton.isSelected()) {
            return false;
        } else {
            return null;
        }
    }

    private String getCompromisedEnvironmentText() {
        if ((getCompromisedEnvironment() || getCompromisedEnvironment() == null) && txtAreaCompromisedEnvironment.getText().isEmpty()) {
            this.setLblRequired(lblCompromisedEnvironment, "Compromised Environment");
            return null;
        } else {
            this.setLblDefault(lblCompromisedEnvironment);
            return txtAreaCompromisedEnvironment.getText();
        }
    }

    private String getDescription() {
        if (txtAreaDescription.getText().isEmpty()) {
            this.setRequiredTitleTab(tabDescriptionImpactSteps, "Description");
            return null;
        } else {
            this.removeRequiredTitleTab(tabDescriptionImpactSteps, "Description");
            Node document = parser.parse(txtAreaDescription.getText());
            return renderer.render(document);
        }
    }

    private String getImpactDescription() {
        if (txtAreaImpact.getText().isEmpty()) {
            this.setRequiredTitleTab(tabDescriptionImpactSteps, "Impact");
            return null;
        } else {
            this.removeRequiredTitleTab(tabDescriptionImpactSteps, "Impact");
            return txtAreaImpact.getText();
        }
    }

    private String getStepsToReproduce() {
        if (txtAreaStepsToReproduce.getText().isEmpty()) {
            this.setRequiredTitleTab(tabDescriptionImpactSteps, "Steps to reproduce");
            return null;
        } else {
            this.removeRequiredTitleTab(tabDescriptionImpactSteps, "Steps to reproduce");
            Node document = parser.parse(txtAreaStepsToReproduce.getText());
            return renderer.render(document);
        }
    }

    private String getProtocol() {
        if (txtFieldProtocol.getText().isEmpty()) {
            this.setLblRequired(lblProtocol, "Protocol");
            return null;
        } else {
            this.setLblDefault(lblProtocol);
            return txtFieldProtocol.getText();
        }
    }

    private String getMethod() {
        if (txtFieldMethod.getText().isEmpty()) {
            this.setLblRequired(lblMethod, "Method");
            return null;
        } else {
            this.setLblDefault(lblMethod);
            return txtFieldMethod.getText();

        }
    }

    private String getUrl() {
        if (txtFieldUrl.getText().isEmpty()) {
            this.setLblRequired(lblUrl, "URI");
            return null;
        } else {
            this.setLblDefault(lblUrl);
            return txtFieldUrl.getText();
        }
    }

    private String getRequest() {
        if (txtAreaRequest.getText().isEmpty()) {
            this.setRequiredTitleTab(tabParametersRequestResponse, "Request");
            return null;
        } else {
            this.removeRequiredTitleTab(tabParametersRequestResponse, "Request");
            return txtAreaRequest.getText().replace("\\", "\\\\");
        }
    }

    private String getResponse() {
        if (txtAreaResponse.getText().isEmpty()) {
            this.setRequiredTitleTab(tabParametersRequestResponse, "Response");
            return null;
        } else {
            this.removeRequiredTitleTab(tabParametersRequestResponse, "Response");
            return txtAreaResponse.getText().replace("\\", "\\\\");
        }
    }

    private ArrayList<Evidence> getEvidence() {
        ArrayList<Evidence> evidenceArrayList = new ArrayList<>();

        for (int i = 0; i < evidenceListModel.getSize(); i++) {
            evidenceArrayList.add(evidenceListModel.get(i));
        }

        if (evidenceArrayList.size() > 0) {
            this.removeRequiredTitleTab(tabDescriptionImpactSteps, "Evidence");
            return evidenceArrayList;
        } else {
            this.setRequiredTitleTab(tabDescriptionImpactSteps, "Evidence");
            return null;
        }
    }

    private String getParameterListAsString() {
        StringBuilder toReturn = new StringBuilder();
        for (int i = 0; i < parametersListModel.getSize(); i++) {
            toReturn.append(parametersListModel.get(i)).append("\n");
        }
        return toReturn.toString().trim();
    }

    public void setRequest(String req) {
        if (this.txtAreaRequest.isEnabled()) this.txtAreaRequest.setEnabled(false);
        this.txtAreaRequest.setText(req);
        this.txtAreaRequest.setCaretPosition(0);
    }

    public void setResponse(String resp) {
        if (this.txtAreaResponse.isEnabled()) this.txtAreaResponse.setEnabled(false);
        this.txtAreaResponse.setText(resp);
        this.txtAreaResponse.setCaretPosition(0);
    }

    public void setTxtFieldMethod(String method) {
        if (this.txtFieldMethod.isEnabled()) this.txtFieldMethod.setEnabled(false);
        this.txtFieldMethod.setText(method);
    }

    public void setTxtFieldUrl(String url) {
        if (this.txtFieldUrl.isEnabled()) this.txtFieldUrl.setEnabled(false);
        this.txtFieldUrl.setText(url);
    }

    public void setTxtFieldProtocol(String prot) {
        if (this.txtFieldProtocol.isEnabled()) this.txtFieldProtocol.setEnabled(false);
        this.txtFieldProtocol.setText(prot);
    }

    public void setListParameters(String[] params) {
        this.parametersListModel.clear();

        for (String p :
                params) {
            this.parametersListModel.addElement(p);
        }
        this.listParameters.setModel(parametersListModel);
    }

    public Vulnerability validateNotification() {
        boolean missingRequiredCamps = false;
        Vulnerability vulnerability = new Vulnerability();
        vulnerability.defineNotification();

        int templateId = getDefinedTemplateId();
        if (templateId != 0) {
            vulnerability.setVulnerability_model_id(getDefinedTemplateId());
        } else {
            missingRequiredCamps = true;
        }

        String definedDescription = getDescription();
        if (definedDescription != null) {
            vulnerability.setClient_impact(definedDescription);
        } else {
            missingRequiredCamps = true;
        }

        ArrayList<Evidence> definedEvidences = getEvidence();
        if (definedEvidences != null) {
            vulnerability.setVulnerability_archives_attributes(definedEvidences);
        } else {
            missingRequiredCamps = true;
        }

        if (missingRequiredCamps) {
            JOptionPane.showMessageDialog(rootPanel2, "Required camps are missing!");
            return null;
        } else {
            return vulnerability;
        }

    }

    public Vulnerability validateVulnerability() {
        boolean missingRequiredCamps = false;
        Vulnerability vulnerability = new Vulnerability();

        int templateId = getDefinedTemplateId();
        if (templateId != 0) {
            vulnerability.setVulnerability_model_id(getDefinedTemplateId());
        } else {
            missingRequiredCamps = true;
        }

        String definedImpact = getDefinedImpact();
        if (definedImpact != null) {
            vulnerability.setImpact(definedImpact);
        } else {
            missingRequiredCamps = true;
        }


        String definedProbability = getDefinedProbability();
        if (definedProbability != null) {
            vulnerability.setProbability(definedProbability);
        } else {
            missingRequiredCamps = true;
        }

        Boolean definedCompromisedEnvironment = getCompromisedEnvironment();
        if (definedCompromisedEnvironment != null) {
            vulnerability.setInvaded(definedCompromisedEnvironment);
        } else {
            missingRequiredCamps = true;
        }

        String definedCompromisedEnvironmentText = getCompromisedEnvironmentText();
        if (definedCompromisedEnvironmentText != null) {
            vulnerability.setInvaded_environment_description(definedCompromisedEnvironmentText);
        } else {
            missingRequiredCamps = true;
        }

        String definedDescriptiong = getDescription();
        if (definedDescriptiong != null) {
            vulnerability.setClient_impact(definedDescriptiong);
        } else {
            missingRequiredCamps = true;
        }

        String definedImpactDescription = getImpactDescription();
        if (definedImpactDescription != null) {
            vulnerability.setImpact_resume(definedImpactDescription);
        } else {
            missingRequiredCamps = true;
        }

        String definedStepsToReproduce = getStepsToReproduce();
        if (definedStepsToReproduce != null) {
            vulnerability.setWeb_steps(definedStepsToReproduce);
        } else {
            missingRequiredCamps = true;
        }

        ArrayList<Evidence> definedEvidences = getEvidence();
        if (definedEvidences != null) {
            vulnerability.setVulnerability_archives_attributes(definedEvidences);
        } else {
            missingRequiredCamps = true;
        }

        String definedMethod = getMethod();
        if (definedMethod != null) {
            vulnerability.setWeb_method(definedMethod);
        } else {
            missingRequiredCamps = true;
        }

        String definedProtocol = getProtocol();
        if (definedProtocol != null) {
            vulnerability.setWeb_protocol(definedProtocol);
        } else {
            missingRequiredCamps = true;
        }

        String definedUrl = getUrl();
        if (definedUrl != null) {
            vulnerability.setWeb_url(definedUrl);
        } else {
            missingRequiredCamps = true;
        }

        vulnerability.setWeb_parameters(getParameterListAsString()); // it is not required, so it can be empty.

        String definedRequest = getRequest();
        if (definedRequest != null) {
            vulnerability.setWeb_request(definedRequest);
        } else {
            missingRequiredCamps = true;
        }

        String definedResponse = getResponse();
        if (definedResponse != null) {
            vulnerability.setWeb_response(definedResponse);
        } else {
            missingRequiredCamps = true;
        }

        if (missingRequiredCamps) {
            JOptionPane.showMessageDialog(rootPanel2, "Required camps are missing!");
            return null;
        } else {
            return vulnerability;
        }

    }

    private void notificationTemplateSelected(boolean isSelected) {
        probabilityHighRButton.setEnabled(!isSelected);
        probabilityMediumRButton.setEnabled(!isSelected);
        probabilityLowRButton.setEnabled(!isSelected);
        impactHighRButton.setEnabled(!isSelected);
        impactMediumRButton.setEnabled(!isSelected);
        impactLowRButton.setEnabled(!isSelected);
        yesCompromisedEnvironmentRButton.setEnabled(!isSelected);
        noCompromisedEnvironmentRButton.setEnabled(!isSelected);
        txtAreaImpact.setEnabled(!isSelected);
        txtAreaStepsToReproduce.setEnabled(!isSelected);

        tabParametersRequestResponse.setEnabled(!isSelected);
        listParameters.setEnabled(!isSelected);
        btnRemoveParameter.setEnabled(!isSelected);
        btnRemoveAllParameters.setEnabled(!isSelected);
        btnRedactValue.setEnabled(!isSelected);

        if (this.fromContextMenu) {
            txtFieldMethod.setEnabled(false);
            txtFieldProtocol.setEnabled(false);
            txtFieldUrl.setEnabled(false);
        } else {
            txtFieldMethod.setEnabled(!isSelected);
            txtFieldProtocol.setEnabled(!isSelected);
            txtFieldUrl.setEnabled(!isSelected);
        }

    }

    public boolean isFromContextMenu() {
        return fromContextMenu;
    }

    public void setFromContextMenu(boolean fromContextMenu) {
        this.fromContextMenu = fromContextMenu;
    }

    public JPanel getRootPanel2() {
        return rootPanel2;
    }

    public JButton getBtnSubmitForm() {
        return btnSubmitForm;
    }

    {
// GUI initializer generated by IntelliJ IDEA GUI Designer
// >>> IMPORTANT!! <<<
// DO NOT EDIT OR ADD ANY CODE HERE!
        $$$setupUI$$$();
    }

    /**
     * Method generated by IntelliJ IDEA GUI Designer
     * >>> IMPORTANT!! <<<
     * DO NOT edit this method OR call it in your code!
     *
     * @noinspection ALL
     */
    private void $$$setupUI$$$() {
        rootPanel = new JScrollPane();
        rootPanel2 = new JPanel();
        rootPanel2.setLayout(new FormLayout("fill:max(d;4px):noGrow,left:75dlu:noGrow,fill:138px:noGrow,left:16dlu:noGrow,fill:88px:noGrow,left:5dlu:noGrow,fill:58px:noGrow,left:7dlu:noGrow,fill:max(d;4px):noGrow,left:14dlu:noGrow,left:10dlu:noGrow,fill:255px:noGrow,left:13dlu:noGrow,fill:10px:noGrow,left:27dlu:noGrow", "center:13px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,center:15px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,top:5dlu:noGrow,center:65px:noGrow,center:17px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,center:138px:noGrow,top:6dlu:noGrow,center:11px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,top:35dlu:noGrow,center:13px:noGrow,center:11px:noGrow,top:4dlu:noGrow,center:206px:noGrow,center:max(d;4px):noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,center:max(d;4px):noGrow"));
        rootPanel.setViewportView(rootPanel2);
        final JPanel panel1 = new JPanel();
        panel1.setLayout(new FormLayout("fill:575px:grow,left:7dlu:noGrow,fill:max(d;4px):noGrow", "center:d:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow"));
        CellConstraints cc = new CellConstraints();
        rootPanel2.add(panel1, cc.xyw(3, 3, 13));
        lblVulnerabilityTemplate = new JLabel();
        Font lblVulnerabilityTemplateFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblVulnerabilityTemplate.getFont());
        if (lblVulnerabilityTemplateFont != null) lblVulnerabilityTemplate.setFont(lblVulnerabilityTemplateFont);
        lblVulnerabilityTemplate.setText("Vulnerability Template");
        panel1.add(lblVulnerabilityTemplate, cc.xy(1, 1));
        cbVulnerabilityTemplates = new JComboBox();
        cbVulnerabilityTemplates.setEditable(true);
        cbVulnerabilityTemplates.putClientProperty("html.disable", Boolean.TRUE);
        panel1.add(cbVulnerabilityTemplates, cc.xy(1, 3));
        btnRefreshVT = new JButton();
        btnRefreshVT.setText("Load templates");
        panel1.add(btnRefreshVT, cc.xy(3, 3));
        final JPanel panel2 = new JPanel();
        panel2.setLayout(new FormLayout("fill:65px:noGrow,left:5dlu:noGrow,fill:70px:noGrow,left:6dlu:noGrow,fill:43px:noGrow,left:10dlu:noGrow,fill:414px:grow", "center:max(d;4px):noGrow,top:4dlu:noGrow,center:16px:noGrow,top:5dlu:noGrow,center:30px:noGrow"));
        rootPanel2.add(panel2, cc.xywh(3, 17, 13, 5));
        lblMethod = new JLabel();
        Font lblMethodFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblMethod.getFont());
        if (lblMethodFont != null) lblMethod.setFont(lblMethodFont);
        lblMethod.setText("Method");
        panel2.add(lblMethod, cc.xyw(1, 3, 2));
        txtFieldMethod = new JTextField();
        txtFieldMethod.putClientProperty("html.disable", Boolean.TRUE);
        panel2.add(txtFieldMethod, cc.xy(1, 5, CellConstraints.FILL, CellConstraints.DEFAULT));
        lblProtocol = new JLabel();
        Font lblProtocolFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblProtocol.getFont());
        if (lblProtocolFont != null) lblProtocol.setFont(lblProtocolFont);
        lblProtocol.setText("Protocol");
        panel2.add(lblProtocol, cc.xyw(3, 3, 2));
        lblUrl = new JLabel();
        Font lblUrlFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblUrl.getFont());
        if (lblUrlFont != null) lblUrl.setFont(lblUrlFont);
        lblUrl.setText("URI");
        panel2.add(lblUrl, cc.xy(5, 3));
        txtFieldProtocol = new JTextField();
        txtFieldProtocol.putClientProperty("html.disable", Boolean.TRUE);
        panel2.add(txtFieldProtocol, cc.xy(3, 5, CellConstraints.FILL, CellConstraints.DEFAULT));
        txtFieldUrl = new JTextField();
        txtFieldUrl.putClientProperty("html.disable", Boolean.TRUE);
        panel2.add(txtFieldUrl, cc.xyw(5, 5, 3, CellConstraints.FILL, CellConstraints.DEFAULT));
        final JPanel panel3 = new JPanel();
        panel3.setLayout(new FormLayout("fill:138px:noGrow,left:16dlu:noGrow,fill:88px:noGrow,left:5dlu:noGrow,fill:58px:noGrow,left:7dlu:noGrow,fill:max(d;4px):noGrow,left:14dlu:noGrow,left:203dlu:noGrow", "center:max(d;4px):noGrow,center:15px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow,top:4dlu:noGrow,top:5dlu:noGrow,center:54px:noGrow"));
        rootPanel2.add(panel3, cc.xywh(3, 5, 13, 7));
        final JPanel panel4 = new JPanel();
        panel4.setLayout(new FormLayout("fill:86px:noGrow,left:8dlu:noGrow,fill:110px:noGrow,left:6dlu:noGrow,fill:105px:noGrow", "center:max(d;4px):noGrow,top:4dlu:noGrow,center:21px:noGrow"));
        panel3.add(panel4, cc.xywh(1, 1, 6, 6));
        probabilityLowRButton = new JRadioButton();
        probabilityLowRButton.setText("Low");
        panel4.add(probabilityLowRButton, cc.xy(1, 3));
        probabilityMediumRButton = new JRadioButton();
        probabilityMediumRButton.setText("Medium");
        panel4.add(probabilityMediumRButton, cc.xy(3, 3));
        probabilityHighRButton = new JRadioButton();
        probabilityHighRButton.setText("High");
        panel4.add(probabilityHighRButton, cc.xy(5, 3));
        lblProbability = new JLabel();
        Font lblProbabilityFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblProbability.getFont());
        if (lblProbabilityFont != null) lblProbability.setFont(lblProbabilityFont);
        lblProbability.setText("Probability");
        panel4.add(lblProbability, cc.xyw(1, 1, 3));
        final JPanel panel5 = new JPanel();
        panel5.setLayout(new FormLayout("fill:86px:noGrow,left:8dlu:noGrow,fill:110px:noGrow,left:7dlu:noGrow,fill:105px:noGrow", "center:max(d;4px):noGrow,top:4dlu:noGrow,center:21px:noGrow"));
        panel3.add(panel5, cc.xyw(1, 7, 6));
        impactLowRButton = new JRadioButton();
        impactLowRButton.setText("Low");
        panel5.add(impactLowRButton, cc.xy(1, 3));
        impactMediumRButton = new JRadioButton();
        impactMediumRButton.setText("Medium");
        panel5.add(impactMediumRButton, cc.xy(3, 3));
        impactHighRButton = new JRadioButton();
        impactHighRButton.setText("High");
        panel5.add(impactHighRButton, cc.xy(5, 3));
        lblImpact = new JLabel();
        Font lblImpactFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblImpact.getFont());
        if (lblImpactFont != null) lblImpact.setFont(lblImpactFont);
        lblImpact.setText("Impact");
        panel5.add(lblImpact, cc.xyw(1, 1, 3));
        final JPanel panel6 = new JPanel();
        panel6.setLayout(new FormLayout("fill:52px:noGrow,left:6dlu:noGrow,fill:294px:noGrow", "center:max(d;4px):noGrow,top:7dlu:noGrow,center:27px:noGrow,top:7dlu:noGrow,center:25px:noGrow"));
        panel3.add(panel6, cc.xywh(9, 1, 1, 7));
        noCompromisedEnvironmentRButton = new JRadioButton();
        noCompromisedEnvironmentRButton.setSelected(true);
        noCompromisedEnvironmentRButton.setText("No");
        panel6.add(noCompromisedEnvironmentRButton, cc.xyw(1, 5, 2));
        lblCompromisedEnvironment = new JLabel();
        Font lblCompromisedEnvironmentFont = this.$$$getFont$$$(null, Font.BOLD, -1, lblCompromisedEnvironment.getFont());
        if (lblCompromisedEnvironmentFont != null) lblCompromisedEnvironment.setFont(lblCompromisedEnvironmentFont);
        lblCompromisedEnvironment.setText("Compromised Environment");
        panel6.add(lblCompromisedEnvironment, cc.xyw(1, 1, 3));
        yesCompromisedEnvironmentRButton = new JRadioButton();
        yesCompromisedEnvironmentRButton.setText("Yes");
        panel6.add(yesCompromisedEnvironmentRButton, cc.xyw(1, 3, 2));
        scrollPaneCompromisedEnvironment = new JScrollPane();
        scrollPaneCompromisedEnvironment.setVisible(false);
        panel6.add(scrollPaneCompromisedEnvironment, cc.xywh(3, 3, 1, 3, CellConstraints.FILL, CellConstraints.FILL));
        txtAreaCompromisedEnvironment = new JTextArea();
        txtAreaCompromisedEnvironment.setVisible(false);
        scrollPaneCompromisedEnvironment.setViewportView(txtAreaCompromisedEnvironment);
        final JSeparator separator1 = new JSeparator();
        separator1.setOrientation(1);
        panel3.add(separator1, cc.xywh(7, 1, 1, 7, CellConstraints.FILL, CellConstraints.FILL));
        tabDescriptionImpactSteps = new JTabbedPane();
        rootPanel2.add(tabDescriptionImpactSteps, cc.xywh(3, 13, 13, 4, CellConstraints.DEFAULT, CellConstraints.FILL));
        tabDescriptionImpactSteps.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEmptyBorder(), null, TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, null, null));
        final JPanel panel7 = new JPanel();
        panel7.setLayout(new FormLayout("fill:d:grow", "center:84px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow"));
        tabDescriptionImpactSteps.addTab("Description", panel7);
        final JScrollPane scrollPane1 = new JScrollPane();
        panel7.add(scrollPane1, cc.xy(1, 1, CellConstraints.FILL, CellConstraints.FILL));
        txtAreaDescription = new JEditorPane();
        txtAreaDescription.setContentType("text/plain");
        scrollPane1.setViewportView(txtAreaDescription);
        btnPreviewDescription = new JButton();
        btnPreviewDescription.setText("Preview");
        panel7.add(btnPreviewDescription, cc.xy(1, 3));
        final JPanel panel8 = new JPanel();
        panel8.setLayout(new FormLayout("fill:d:grow", "center:84px:noGrow"));
        tabDescriptionImpactSteps.addTab("Impact", panel8);
        final JScrollPane scrollPane2 = new JScrollPane();
        panel8.add(scrollPane2, cc.xy(1, 1, CellConstraints.FILL, CellConstraints.FILL));
        txtAreaImpact = new JTextArea();
        txtAreaImpact.setText("");
        txtAreaImpact.putClientProperty("html.disable", Boolean.TRUE);
        scrollPane2.setViewportView(txtAreaImpact);
        final JPanel panel9 = new JPanel();
        panel9.setLayout(new FormLayout("fill:d:grow", "center:84px:noGrow,top:4dlu:noGrow,center:max(d;4px):noGrow"));
        tabDescriptionImpactSteps.addTab("Steps to reproduce", panel9);
        final JScrollPane scrollPane3 = new JScrollPane();
        panel9.add(scrollPane3, cc.xy(1, 1, CellConstraints.FILL, CellConstraints.FILL));
        txtAreaStepsToReproduce = new JEditorPane();
        txtAreaStepsToReproduce.setContentType("text/plain");
        scrollPane3.setViewportView(txtAreaStepsToReproduce);
        btnPreviewStepsToReproduce = new JButton();
        btnPreviewStepsToReproduce.setText("Preview");
        panel9.add(btnPreviewStepsToReproduce, cc.xy(1, 3));
        final JPanel panel10 = new JPanel();
        panel10.setLayout(new FormLayout("fill:708px:grow", "center:125px:noGrow"));
        tabDescriptionImpactSteps.addTab("Evidence", panel10);
        final JScrollPane scrollPane4 = new JScrollPane();
        panel10.add(scrollPane4, cc.xy(1, 1, CellConstraints.DEFAULT, CellConstraints.FILL));
        listEvidence = new JList();
        listEvidence.putClientProperty("List.isFileList", Boolean.TRUE);
        listEvidence.putClientProperty("html.disable", Boolean.FALSE);
        scrollPane4.setViewportView(listEvidence);
        tabParametersRequestResponse = new JTabbedPane();
        Font tabParametersRequestResponseFont = this.$$$getFont$$$(null, -1, -1, tabParametersRequestResponse.getFont());
        if (tabParametersRequestResponseFont != null)
            tabParametersRequestResponse.setFont(tabParametersRequestResponseFont);
        tabParametersRequestResponse.setTabLayoutPolicy(0);
        tabParametersRequestResponse.setTabPlacement(1);
        rootPanel2.add(tabParametersRequestResponse, cc.xywh(3, 23, 13, 3, CellConstraints.DEFAULT, CellConstraints.FILL));
        tabParametersRequestResponse.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEmptyBorder(), null, TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, null, null));
        final JPanel panel11 = new JPanel();
        panel11.setLayout(new FormLayout("fill:713px:grow", "top:148px:noGrow,center:max(d;4px):noGrow"));
        Font panel11Font = this.$$$getFont$$$(null, -1, -1, panel11.getFont());
        if (panel11Font != null) panel11.setFont(panel11Font);
        tabParametersRequestResponse.addTab("Parameters", panel11);
        final JScrollPane scrollPane5 = new JScrollPane();
        panel11.add(scrollPane5, cc.xy(1, 1, CellConstraints.FILL, CellConstraints.FILL));
        listParameters = new JList();
        listParameters.putClientProperty("html.disable", Boolean.TRUE);
        scrollPane5.setViewportView(listParameters);
        final JPanel panel12 = new JPanel();
        panel12.setLayout(new FormLayout("fill:100px:noGrow,left:4dlu:noGrow,fill:116px:noGrow,left:4dlu:noGrow,fill:max(d;4px):noGrow", "center:46px:noGrow"));
        panel11.add(panel12, cc.xy(1, 2, CellConstraints.DEFAULT, CellConstraints.BOTTOM));
        btnRemoveAllParameters = new JButton();
        btnRemoveAllParameters.setText("Remove All");
        panel12.add(btnRemoveAllParameters, cc.xy(3, 1));
        btnRemoveParameter = new JButton();
        btnRemoveParameter.setText("Remove");
        panel12.add(btnRemoveParameter, cc.xy(1, 1));
        btnRedactValue = new JButton();
        btnRedactValue.setText("Redact Value");
        panel12.add(btnRedactValue, cc.xy(5, 1));
        final JPanel panel13 = new JPanel();
        panel13.setLayout(new FormLayout("fill:d:grow", "center:193px:noGrow"));
        tabParametersRequestResponse.addTab("Request", panel13);
        final JScrollPane scrollPane6 = new JScrollPane();
        panel13.add(scrollPane6, cc.xy(1, 1, CellConstraints.DEFAULT, CellConstraints.FILL));
        txtAreaRequest = new JTextArea();
        txtAreaRequest.putClientProperty("html.disable", Boolean.TRUE);
        scrollPane6.setViewportView(txtAreaRequest);
        final JPanel panel14 = new JPanel();
        panel14.setLayout(new FormLayout("fill:270px:grow", "center:193px:noGrow"));
        tabParametersRequestResponse.addTab("Response", panel14);
        final JScrollPane scrollPane7 = new JScrollPane();
        panel14.add(scrollPane7, cc.xy(1, 1, CellConstraints.DEFAULT, CellConstraints.FILL));
        txtAreaResponse = new JTextArea();
        txtAreaResponse.putClientProperty("html.disable", Boolean.TRUE);
        scrollPane7.setViewportView(txtAreaResponse);
        final JPanel panel15 = new JPanel();
        panel15.setLayout(new FormLayout("fill:d:noGrow,left:4dlu:noGrow,fill:max(d;4px):noGrow", "center:d:noGrow"));
        rootPanel2.add(panel15, cc.xyw(3, 29, 3));
        btnSubmitForm = new JButton();
        btnSubmitForm.setText("Submit");
        panel15.add(btnSubmitForm, cc.xy(1, 1));
        btnClearForm = new JButton();
        btnClearForm.setText("Clear");
        panel15.add(btnClearForm, cc.xy(3, 1));
        ButtonGroup buttonGroup;
        buttonGroup = new ButtonGroup();
        buttonGroup.add(probabilityLowRButton);
        buttonGroup.add(probabilityMediumRButton);
        buttonGroup.add(probabilityHighRButton);
        buttonGroup = new ButtonGroup();
        buttonGroup.add(impactLowRButton);
        buttonGroup.add(impactMediumRButton);
        buttonGroup.add(impactHighRButton);
        buttonGroup = new ButtonGroup();
        buttonGroup.add(noCompromisedEnvironmentRButton);
        buttonGroup.add(yesCompromisedEnvironmentRButton);
    }

    /**
     * @noinspection ALL
     */
    private Font $$$getFont$$$(String fontName, int style, int size, Font currentFont) {
        if (currentFont == null) return null;
        String resultName;
        if (fontName == null) {
            resultName = currentFont.getName();
        } else {
            Font testFont = new Font(fontName, Font.PLAIN, 10);
            if (testFont.canDisplay('a') && testFont.canDisplay('1')) {
                resultName = fontName;
            } else {
                resultName = currentFont.getName();
            }
        }
        Font font = new Font(resultName, style >= 0 ? style : currentFont.getStyle(), size >= 0 ? size : currentFont.getSize());
        boolean isMac = System.getProperty("os.name", "").toLowerCase(Locale.ENGLISH).startsWith("mac");
        Font fontWithFallback = isMac ? new Font(font.getFamily(), font.getStyle(), font.getSize()) : new StyleContext().getFont(font.getFamily(), font.getStyle(), font.getSize());
        return fontWithFallback instanceof FontUIResource ? fontWithFallback : new FontUIResource(fontWithFallback);
    }

    /**
     * @noinspection ALL
     */
    public JComponent $$$getRootComponent$$$() {
        return rootPanel;
    }

}

