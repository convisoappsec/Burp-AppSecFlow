package view.new_vulnerability.custom.popup_menu;

import models.vulnerability.Evidence;

import javax.swing.*;
import javax.swing.filechooser.FileSystemView;
import java.io.File;

public class EvidencePopupMenu extends JPopupMenu {
    JMenuItem addEvidence;
    JMenuItem removeEvidence;
    DefaultListModel<Evidence> evidenceListModel;
    JList listEvidence;
    String evidencePlaceholder = "<html><b>Double left click</b> or <b>Right click</b> to add new evidence</html>";

    public EvidencePopupMenu(DefaultListModel<Evidence> evidenceListModel, JList evidenceList){
        this.evidenceListModel = evidenceListModel;
        this.listEvidence = evidenceList;

        addEvidence = new JMenuItem("Add");

        addEvidence.addActionListener(e -> new Thread(() -> {

            JFileChooser jFileChooser = new JFileChooser(FileSystemView.getFileSystemView().getDefaultDirectory());
            int returnValue = jFileChooser.showOpenDialog(this);

            if (returnValue == JFileChooser.APPROVE_OPTION) {
                File selectedFile = jFileChooser.getSelectedFile();
                Evidence evidence = new Evidence(selectedFile.getAbsolutePath(), selectedFile.getName());
                if(evidence.validateExtension()){
                    if(evidenceListModel.get(0).getName().equals(evidencePlaceholder)){
                        evidenceListModel.clear();
                        evidenceList.putClientProperty("html.disable", Boolean.TRUE);
                    }
                    evidenceListModel.addElement(evidence);
                }else{
                    JOptionPane.showMessageDialog(this, "Invalid extension!\n" +
                            "Please use : .pdf .zip .jpg .jpeg .png .txt .doc .xls .rar .docx .gif");
                }

            }

        }).start());


        removeEvidence = new JMenuItem("Remove");

        removeEvidence.addActionListener(e -> new Thread(() -> {
            this.evidenceListModel.remove(this.listEvidence.getSelectedIndex());
            if(evidenceListModel.size() == 0){
                evidenceList.putClientProperty("html.disable", Boolean.FALSE);
                evidenceListModel.addElement(new Evidence(evidencePlaceholder, evidencePlaceholder));
            }
        }).start());


        add(addEvidence);
        add(removeEvidence);

    }

}
